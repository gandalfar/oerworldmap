<VirtualHost *:80>

  ServerName oerworldmap.graphthinking.com
  ServerAdmin webmaster@localhost

  Include /home/fo/local/src/oerworldmap/data/permissions

  AllowEncodedSlashes NoDecode
  RewriteEngine On

  # API
  RewriteCond %{HTTP:Accept} application/json
  RewriteRule ^((/resource.*|/user|/aggregation|/feed|/country|/log|/index|/sparql|/label|/reconcile).*) http://localhost:9000$1 [P,L]

  RewriteCond %{REQUEST_URI} /resource.*\..+$
  RewriteRule (/resource.*) http://localhost:9000$1 [P,L]

  RewriteCond %{HTTP:Authorization} ^.+$
  RewriteRule ^/$ /resource/ [R]

  ProxyPass /assets/json http://localhost:9000/assets/json
  ProxyPassReverse /assets/json http://localhost:9000/assets/json

  ProxyPass /robots.txt http://localhost:9000/robots.txt
  ProxyPassReverse /robots.txt http://localhost:9000/robots.txt

  # Kibana
  ProxyPass /kibana/ http://localhost:5601/
  ProxyPassReverse /kibana/ http://localhost:5601/

  # UI
  ProxyPass /oerworldmap-static/ https://hbz.github.io/oerworldmap-static/
  ProxyPassReverse /oerworldmap-static/ https://hbz.github.io/oerworldmap-static/
  ProxyPassMatch /(.+/.*) http://localhost:3000/$1
  ProxyPassReverse /(.+/.*) http://localhost:3000/$1

  # Static
  SSLProxyEngine On
  ProxyPass / https://hbz.github.io/oerworldmap-static/
  ProxyPassReverse / https://hbz.github.io/oerworldmap-static/

  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
