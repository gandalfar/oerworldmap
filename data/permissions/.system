ErrorDocument 401 "<h1>Not allowed</h1><p>Sign up or reset password <a href=/user/register>here</a>.</p>"

<Location />
  AuthType Basic
  AuthName "Restricted Files"
  AuthUserFile ${AUTH_DIR}/auth/htpasswd
  AuthGroupFile ${AUTH_DIR}/auth/htgroups
  Require all granted
</Location>

RewriteEngine On
RewriteMap unescape int:unescape
RewriteCond %{REQUEST_URI}  ^/.loggedIn$
RewriteCond %{QUERY_STRING} ^continue=(.*)$
RewriteRule ^/?.loggedIn$ ${unescape:%1} [R=302,L,QSD,NE]

RewriteCond %{REQUEST_URI}  ^/.loggedIn$
RewriteRule ^/?.loggedIn$ / [R=302,L,QSD,NE]

<Location /.login>
  Require valid-user
  Redirect "/.login" "/.loggedIn"
</Location>

<Location /.logout>
  AuthUserFile /dev/null
  Require valid-user
</Location>

<Location /resource/>
  <LimitExcept GET DELETE>
    Require valid-user
    Require group admin
  </LimitExcept>
  <Limit DELETE>
    Require group admin
  </Limit>
</Location>

<Location /resource/*/comment>
  Require valid-user
</Location>

<Location /resource/*/like>
  Require valid-user
</Location>

<Location /log/>
  Require group editor
  Require group admin
</Location>

<Location /record/>
  Require group admin
</Location>

<Location /import/>
  Require group admin
</Location>

<Location /index/>
  Require group admin
</Location>

<Location /user/groups>
  Require group admin
</Location>

<Location /sparql/>
  Require group admin
</Location>

<Location /user/password>
  Require valid-user
</Location>

<Location /user/password/reset>
  Require all granted
</Location>

<Location /user/profile>
  Require valid-user
</Location>
